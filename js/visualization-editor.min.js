(function(e){e.Jcrop=function(t,n){function i(e){return Math.round(e)+"px"}function o(e){return J.baseClass+"-"+e}function r(){return e.fx.step.hasOwnProperty("backgroundColor")}function a(t){var n=e(t).offset();return[n.left,n.top]}function s(e){return[e.pageX-T[0],e.pageY-T[1]]}function c(t){"object"!=typeof t&&(t={}),J=e.extend(J,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof J[t]&&(J[t]=function(){})})}function u(e,t,n){if(T=a(Y),pt.setCursor("move"===e?e:e+"-resize"),"move"===e)return pt.activateHandlers(l(t),v,n);var i=lt.getFixed(),o=h(e),r=lt.getCorner(h(o));lt.setPressed(lt.getCorner(o)),lt.setCurrent(r),pt.activateHandlers(d(e,i),v,n)}function d(e,t){return function(n){if(J.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}lt.setCurrent(n),ft.update()}}function l(e){var t=e;return gt.watchKeys(),function(e){lt.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ft.update()}}function h(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function f(e){return function(t){return J.disabled?!1:"move"!==e||J.allowMove?(T=a(Y),it=!0,u(e,s(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function p(e,t,n){var i=e.width(),o=e.height();i>t&&t>0&&(i=t,o=t/e.width()*e.height()),o>n&&n>0&&(o=n,i=n/e.height()*e.width()),tt=e.width()/i,nt=e.height()/o,e.width(i).height(o)}function g(e){return{x:e.x*tt,y:e.y*nt,x2:e.x2*tt,y2:e.y2*nt,w:e.w*tt,h:e.h*nt}}function v(){var e=lt.getFixed();e.w>J.minSelect[0]&&e.h>J.minSelect[1]?(ft.enableHandles(),ft.done()):ft.release(),pt.setCursor(J.allowSelect?"crosshair":"default")}function b(e){if(J.disabled)return!1;if(!J.allowSelect)return!1;it=!0,T=a(Y),ft.disableHandles(),pt.setCursor("crosshair");var t=s(e);return lt.setPressed(t),ft.update(),pt.activateHandlers(w,v,"touch"===e.type.substring(0,5)),gt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function w(e){lt.setCurrent(e),ft.update()}function m(){var t=e("<div></div>").addClass(o("tracker"));return A&&t.css({opacity:0,backgroundColor:"white"}),t}function y(e){q.removeClass().addClass(o("holder")).addClass(e)}function x(e,t){function n(){window.setTimeout(w,l)}var i=e[0]/tt,o=e[1]/nt,r=e[2]/tt,a=e[3]/nt;if(!ot){var s=lt.flipCoords(i,o,r,a),c=lt.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=J.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],v=0,b=J.swingSpeed;i=d[0],o=d[1],r=d[2],a=d[3],ft.animMode(!0);var w=function(){return function(){v+=(100-v)/b,d[0]=Math.round(i+v/100*h),d[1]=Math.round(o+v/100*f),d[2]=Math.round(r+v/100*p),d[3]=Math.round(a+v/100*g),v>=99.8&&(v=100),100>v?(S(d),n()):(ft.done(),ft.animMode(!1),"function"==typeof t&&t.call(vt))}}();n()}}function C(e){S([e[0]/tt,e[1]/nt,e[2]/tt,e[3]/nt]),J.onSelect.call(vt,g(lt.getFixed())),ft.enableHandles()}function S(e){lt.setPressed([e[0],e[1]]),lt.setCurrent([e[2],e[3]]),ft.update()}function k(){return g(lt.getFixed())}function z(){return lt.getFixed()}function M(e){c(e),H()}function O(){J.disabled=!0,ft.disableHandles(),ft.setCursor("default"),pt.setCursor("default")}function j(){J.disabled=!1,H()}function I(){ft.done(),pt.activateHandlers(null,null)}function F(){q.remove(),_.show(),_.css("visibility","visible"),e(t).removeData("Jcrop")}function B(e,t){ft.release(),O();var n=new Image;n.onload=function(){var i=n.width,o=n.height,r=J.boxWidth,a=J.boxHeight;Y.width(i).height(o),Y.attr("src",e),L.attr("src",e),p(Y,r,a),Q=Y.width(),V=Y.height(),L.width(Q).height(V),st.width(Q+2*at).height(V+2*at),q.width(Q).height(V),ht.resize(Q,V),j(),"function"==typeof t&&t.call(vt)},n.src=e}function D(e,t,n){var i=t||J.bgColor;J.bgFade&&r()&&J.fadeTime&&!n?e.animate({backgroundColor:i},{queue:!1,duration:J.fadeTime}):e.css("backgroundColor",i)}function H(e){J.allowResize?e?ft.enableOnly():ft.enableHandles():ft.disableHandles(),pt.setCursor(J.allowSelect?"crosshair":"default"),ft.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(tt=J.trueSize[0]/Q,nt=J.trueSize[1]/V),J.hasOwnProperty("setSelect")&&(C(J.setSelect),ft.done(),delete J.setSelect),ht.refresh(),J.bgColor!=ct&&(D(J.shade?ht.getShades():q,J.shade?J.shadeColor||J.bgColor:J.bgColor),ct=J.bgColor),ut!=J.bgOpacity&&(ut=J.bgOpacity,J.shade?ht.refresh():ft.setBgOpacity(ut)),G=J.maxSize[0]||0,U=J.maxSize[1]||0,Z=J.minSize[0]||0,et=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(Y.attr("src",J.outerImage),delete J.outerImage),ft.refresh()}var T,J=e.extend({},e.Jcrop.defaults),P=navigator.userAgent.toLowerCase(),A=/msie/.test(P),R=/msie [1-6]\./.test(P);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),c(n);var K={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},_=e(t),E=!0;if("IMG"==t.tagName){if(0!=_[0].width&&0!=_[0].height)_.width(_[0].width),_.height(_[0].height);else{var W=new Image;W.src=_[0].src,_.width(W.width),_.height(W.height)}var Y=_.clone().removeAttr("id").css(K).show();Y.width(_.width()),Y.height(_.height()),_.after(Y).hide()}else Y=_.css(K).show(),E=!1,null===J.shade&&(J.shade=!0);p(Y,J.boxWidth,J.boxHeight);var Q=Y.width(),V=Y.height(),q=e("<div />").width(Q).height(V).addClass(o("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(_).append(Y);J.addClass&&q.addClass(J.addClass);var L=e("<div />"),N=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),X=e("<div />").width("100%").height("100%").css("zIndex",320),$=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=lt.getFixed();J.onDblClick.call(vt,e)}).insertBefore(Y).append(N,X);E&&(L=e("<img />").attr("src",Y.attr("src")).css(K).width(Q).height(V),N.append(L)),R&&$.css({overflowY:"hidden"});var G,U,Z,et,tt,nt,it,ot,rt,at=J.boundary,st=m().width(Q+2*at).height(V+2*at).css({position:"absolute",top:i(-at),left:i(-at),zIndex:290}).mousedown(b),ct=J.bgColor,ut=J.bgOpacity;T=a(Y);var dt=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],i=document.createElement("div");try{for(e=0;n.length>e;e++){var o=n[e];o="on"+o;var r=o in i;r||(i.setAttribute(o,"return;"),r="function"==typeof i[o]),t[n[e]]=r}return t.touchstart&&t.touchend&&t.touchmove}catch(a){return!1}}function t(){return J.touchSupport===!0||J.touchSupport===!1?J.touchSupport:e()}return{createDragger:function(e){return function(t){return J.disabled?!1:"move"!==e||J.allowMove?(T=a(Y),it=!0,u(e,s(dt.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return b(dt.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),lt=function(){function e(e){e=a(e),p=h=e[0],g=f=e[1]}function t(e){e=a(e),d=e[0]-p,l=e[1]-g,p=e[0],g=e[1]}function n(){return[d,l]}function i(e){var t=e[0],n=e[1];0>h+t&&(t-=t+h),0>f+n&&(n-=n+f),g+n>V&&(n+=V-(g+n)),p+t>Q&&(t+=Q-(p+t)),h+=t,p+=t,f+=n,g+=n}function o(e){var t=r();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function r(){if(!J.aspectRatio)return c();var e,t,n,i,o=J.aspectRatio,r=J.minSize[0]/tt,a=J.maxSize[0]/tt,d=J.maxSize[1]/nt,l=p-h,v=g-f,b=Math.abs(l),w=Math.abs(v),m=b/w;return 0===a&&(a=10*Q),0===d&&(d=10*V),o>m?(t=g,n=w*o,e=0>l?h-n:n+h,0>e?(e=0,i=Math.abs((e-h)/o),t=0>v?f-i:i+f):e>Q&&(e=Q,i=Math.abs((e-h)/o),t=0>v?f-i:i+f)):(e=p,i=b/o,t=0>v?f-i:f+i,0>t?(t=0,n=Math.abs((t-f)*o),e=0>l?h-n:n+h):t>V&&(t=V,n=Math.abs(t-f)*o,e=0>l?h-n:n+h)),e>h?(r>e-h?e=h+r:e-h>a&&(e=h+a),t=t>f?f+(e-h)/o:f-(e-h)/o):h>e&&(r>h-e?e=h-r:h-e>a&&(e=h-a),t=t>f?f+(h-e)/o:f-(h-e)/o),0>e?(h-=e,e=0):e>Q&&(h-=e-Q,e=Q),0>t?(f-=t,t=0):t>V&&(f-=t-V,t=V),u(s(h,f,e,t))}function a(e){return 0>e[0]&&(e[0]=0),0>e[1]&&(e[1]=0),e[0]>Q&&(e[0]=Q),e[1]>V&&(e[1]=V),[Math.round(e[0]),Math.round(e[1])]}function s(e,t,n,i){var o=e,r=n,a=t,s=i;return e>n&&(o=n,r=e),t>i&&(a=i,s=t),[o,a,r,s]}function c(){var e,t=p-h,n=g-f;return G&&Math.abs(t)>G&&(p=t>0?h+G:h-G),U&&Math.abs(n)>U&&(g=n>0?f+U:f-U),et/nt&&et/nt>Math.abs(n)&&(g=n>0?f+et/nt:f-et/nt),Z/tt&&Z/tt>Math.abs(t)&&(p=t>0?h+Z/tt:h-Z/tt),0>h&&(p-=h,h-=h),0>f&&(g-=f,f-=f),0>p&&(h-=p,p-=p),0>g&&(f-=g,g-=g),p>Q&&(e=p-Q,h-=e,p-=e),g>V&&(e=g-V,f-=e,g-=e),h>Q&&(e=h-V,g-=e,f-=e),f>V&&(e=f-V,g-=e,f-=e),u(s(h,f,p,g))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d,l,h=0,f=0,p=0,g=0;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:i,getCorner:o,getFixed:r}}(),ht=function(){function t(e,t){p.left.css({height:i(t)}),p.right.css({height:i(t)})}function n(){return o(lt.getFixed())}function o(e){p.top.css({left:i(e.x),width:i(e.w),height:i(e.y)}),p.bottom.css({top:i(e.y2),left:i(e.x),width:i(e.w),height:i(V-e.y2)}),p.right.css({left:i(e.x2),width:i(Q-e.x2)}),p.left.css({width:i(e.x)})}function r(){return e("<div />").css({position:"absolute",backgroundColor:J.shadeColor||J.bgColor}).appendTo(f)}function a(){h||(h=!0,f.insertBefore(Y),n(),ft.setBgOpacity(1,0,1),L.hide(),s(J.shadeColor||J.bgColor,1),ft.isAwake()?u(J.bgOpacity,1):u(1,1))}function s(e,t){D(l(),e,t)}function c(){h&&(f.remove(),L.show(),h=!1,ft.isAwake()?ft.setBgOpacity(J.bgOpacity,1,1):(ft.setBgOpacity(1,1,1),ft.disableHandles()),D(q,0,1))}function u(e,t){h&&(J.bgFade&&!t?f.animate({opacity:1-e},{queue:!1,duration:J.fadeTime}):f.css({opacity:1-e}))}function d(){J.shade?a():c(),ft.isAwake()&&u(J.bgOpacity)}function l(){return f.children()}var h=!1,f=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),p={top:r(),left:r().height(V),right:r().height(V),bottom:r()};return{update:n,updateRaw:o,getShades:l,setBgColor:s,enable:a,disable:c,resize:t,refresh:d,opacity:u}}(),ft=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:J.borderOpacity}).addClass(o(t));return N.append(n),n}function n(t,n){var i=e("<div />").mousedown(f(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return dt.support&&i.bind("touchstart.jcrop",dt.createDragger(t)),X.append(i),i}function r(e){var t=J.handleSize,i=n(e,O++).css({opacity:J.handleOpacity}).addClass(o("handle"));return t&&i.width(t).height(t),i}function a(e){return n(e,O++).addClass("jcrop-dragbar")}function s(e){var t;for(t=0;e.length>t;t++)F[e[t]]=a(e[t])}function c(e){var n,i;for(i=0;e.length>i;i++){switch(e[i]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}j[e[i]]=t(n)}}function u(e){var t;for(t=0;e.length>t;t++)I[e[t]]=r(e[t])}function d(e,t){J.shade||L.css({top:i(-t),left:i(-e)}),$.css({top:i(t),left:i(e)})}function l(e,t){$.width(Math.round(e)).height(Math.round(t))}function h(){var e=lt.getFixed();lt.setPressed([e.x,e.y]),lt.setCurrent([e.x2,e.y2]),p()}function p(e){return M?v(e):void 0}function v(e){var t=lt.getFixed();l(t.w,t.h),d(t.x,t.y),J.shade&&ht.updateRaw(t),M||w(),e?J.onSelect.call(vt,g(t)):J.onChange.call(vt,g(t))}function b(e,t,n){(M||t)&&(J.bgFade&&!n?Y.animate({opacity:e},{queue:!1,duration:J.fadeTime}):Y.css("opacity",e))}function w(){$.show(),J.shade?ht.opacity(ut):b(ut,!0),M=!0}function y(){S(),$.hide(),J.shade?ht.opacity(1):b(1),M=!1,J.onRelease.call(vt)}function x(){B&&X.show()}function C(){return B=!0,J.allowResize?(X.show(),!0):void 0}function S(){B=!1,X.hide()}function k(e){e?(ot=!0,S()):(ot=!1,C())}function z(){k(!1),h()}var M,O=370,j={},I={},F={},B=!1;J.dragEdges&&e.isArray(J.createDragbars)&&s(J.createDragbars),e.isArray(J.createHandles)&&u(J.createHandles),J.drawBorders&&e.isArray(J.createBorders)&&c(J.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var D=m().mousedown(f("move")).css({cursor:"move",position:"absolute",zIndex:360});return dt.support&&D.bind("touchstart.jcrop",dt.createDragger("move")),N.append(D),S(),{updateVisible:p,update:v,release:y,refresh:h,isAwake:function(){return M},setCursor:function(e){D.css("cursor",e)},enableHandles:C,enableOnly:function(){B=!0},showHandles:x,disableHandles:S,animMode:k,setBgOpacity:b,done:z}}(),pt=function(){function t(t){st.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",c):h&&e(document).bind("mousemove.jcrop",i).bind("mouseup.jcrop",o)}function n(){st.css({zIndex:290}),e(document).unbind(".jcrop")}function i(e){return d(s(e)),!1}function o(e){return e.preventDefault(),e.stopPropagation(),it&&(it=!1,l(s(e)),ft.isAwake()&&J.onSelect.call(vt,g(lt.getFixed())),n(),d=function(){},l=function(){}),!1}function r(e,n,i){return it=!0,d=e,l=n,t(i),!1}function a(e){return d(s(dt.cfilter(e))),!1}function c(e){return o(dt.cfilter(e))}function u(e){st.css("cursor",e)}var d=function(){},l=function(){},h=J.trackDocument;return h||st.mousemove(i).mouseup(o).mouseout(o),Y.before(st),{activateHandlers:r,setCursor:u}}(),gt=function(){function t(){J.keySupport&&(r.show(),r.focus())}function n(){r.hide()}function i(e,t,n){J.allowMove&&(lt.moveOffset([t,n]),ft.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function o(e){if(e.ctrlKey||e.metaKey)return!0;rt=e.shiftKey?!0:!1;var t=rt?10:1;switch(e.keyCode){case 37:i(e,-t,0);break;case 39:i(e,t,0);break;case 38:i(e,0,-t);break;case 40:i(e,0,t);break;case 27:J.allowSelect&&ft.release();break;case 9:return!0}return!1}var r=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=e("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return J.keySupport&&(r.keydown(o).blur(n),R||!J.fixedSupport?(r.css({position:"absolute",left:"-20px"}),a.append(r).insertBefore(Y)):r.insertBefore(Y)),{watchKeys:t}}();dt.support&&st.bind("touchstart.jcrop",dt.newSelection),X.hide(),H(!0);var vt={setImage:B,animateTo:x,setSelect:C,setOptions:M,tellSelect:k,tellScaled:z,setClass:y,disable:O,enable:j,cancel:I,release:ft.release,destroy:F,focus:gt.watchKeys,getBounds:function(){return[Q*tt,V*nt]},getWidgetSize:function(){return[Q,V]},getScaleFactor:function(){return[tt,nt]},getOptions:function(){return J},ui:{holder:q,selection:$}};return A&&q.bind("selectstart",function(){return!1}),_.data("Jcrop",vt),vt},e.fn.Jcrop=function(t,n){var i;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),i=e.Jcrop(this,t),e.isFunction(n)&&n.call(i)}):(e(this).css({display:"block",visibility:"hidden"}),i=e.Jcrop(this,t),e.isFunction(n)&&n.call(i))}),this},e.Jcrop.Loader=function(t,n,i){function o(){a.complete?(r.unbind(".jcloader"),e.isFunction(n)&&n.call(a)):window.setTimeout(o,50)}var r=e(t),a=r[0];r.bind("load.jcloader",o).bind("error.jcloader",function(){r.unbind(".jcloader"),e.isFunction(i)&&i.call(a)}),a.complete&&e.isFunction(n)&&(r.unbind(".jcloader"),n.call(a))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery),function(){jQuery(function(e){var t,n,i,o,r,a,s,c,u,d,l,h,f,p,g,v,b,w;return r=function(){return e("#positioning, #visualization .visualization").hide()},r(),t="click",n="<div/>",u=null,d=null,s=null,c=null,o=function(e,t,n){return e.fadeOut(function(){return e.add(t).remove(),"function"==typeof n?n():void 0})},i=function(){return window.confirm("Confirm mapping position?")},l=function(t){var n;return n=e("#positioning"),n.find(".positioning-coordinate-x1").val(Math.round(t.x)),n.find(".positioning-coordinate-y1").val(Math.round(t.y)),n.find(".positioning-coordinate-x2").val(Math.round(t.x2)),n.find(".positioning-coordinate-y2").val(Math.round(t.y2))},f=function(t){return e("#visualization-id").val(t)},h=function(t){var n,r;return n=t.find("img"),r=n.data(),n.Jcrop({boxWidth:t.width(),trueSize:[r.width,r.height],onSelect:function(r){return i()?(l(r),f(e(n).data("id")),o(t,c)):void 0}})},g=function(i){var r,a;if(i)return s||(s=e(n,{id:"tv-mapper"}).hide(),c=e(n,{id:"tv-modal-bg"}).on(t,function(){return o(s,c)}),e("body").append(s).append(c)),r=e("<img/>",{src:i.src,data:{id:i.id,width:i.width,height:i.height}}),a=e(n,{"class":"mapper-wrapper"}).append(r),s.append(a),h(s),s.fadeIn()},w=function(e){return o(u,d,function(){var t;return t=JSON.parse(e),g(t)})},a=function(t){var n;return n={action:"get_visualization_mapper",visualizationId:t},e.post(ajaxurl,n,w)},p=function(n){return n.on(t,".image",function(){var t;return t=e(this).parents("tr").data("visualizationId"),a(t)})},v=function(i){return i?(u||(u=e(n,{id:"tv-modal"}).hide(),d=e(n,{id:"tv-modal-bg"}).on(t,function(){return o(u,d)}),e("body").append(u).append(d)),u.html(i),p(u),u.fadeIn()):void 0},b=function(t){return t.preventDefault(),e.post(ajaxurl,{action:"get_visualizations_list"},v)},e("#visualization").on(t,".js-visualization-trigger",b)})}.call(this);