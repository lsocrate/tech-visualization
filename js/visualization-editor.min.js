(function(t){t.Jcrop=function(e,n){function i(t){return Math.round(t)+"px"}function o(t){return J.baseClass+"-"+t}function r(){return t.fx.step.hasOwnProperty("backgroundColor")}function a(e){var n=t(e).offset();return[n.left,n.top]}function s(t){return[t.pageX-T[0],t.pageY-T[1]]}function c(e){"object"!=typeof e&&(e={}),J=t.extend(J,e),t.each(["onChange","onSelect","onRelease","onDblClick"],function(t,e){"function"!=typeof J[e]&&(J[e]=function(){})})}function u(t,e,n){if(T=a(N),pe.setCursor("move"===t?t:t+"-resize"),"move"===t)return pe.activateHandlers(l(e),v,n);var i=le.getFixed(),o=h(t),r=le.getCorner(h(o));le.setPressed(le.getCorner(o)),le.setCurrent(r),pe.activateHandlers(d(t,i),v,n)}function d(t,e){return function(n){if(J.aspectRatio)switch(t){case"e":n[1]=e.y+1;break;case"w":n[1]=e.y+1;break;case"n":n[0]=e.x+1;break;case"s":n[0]=e.x+1}else switch(t){case"e":n[1]=e.y2;break;case"w":n[1]=e.y2;break;case"n":n[0]=e.x2;break;case"s":n[0]=e.x2}le.setCurrent(n),fe.update()}}function l(t){var e=t;return ge.watchKeys(),function(t){le.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,fe.update()}}function h(t){switch(t){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function f(t){return function(e){return J.disabled?!1:"move"!==t||J.allowMove?(T=a(N),ie=!0,u(t,s(e)),e.stopPropagation(),e.preventDefault(),!1):!1}}function p(t,e,n){var i=t.width(),o=t.height();i>e&&e>0&&(i=e,o=e/t.width()*t.height()),o>n&&n>0&&(o=n,i=n/t.height()*t.width()),ee=t.width()/i,ne=t.height()/o,t.width(i).height(o)}function g(t){return{x:t.x*ee,y:t.y*ne,x2:t.x2*ee,y2:t.y2*ne,w:t.w*ee,h:t.h*ne}}function v(){var t=le.getFixed();t.w>J.minSelect[0]&&t.h>J.minSelect[1]?(fe.enableHandles(),fe.done()):fe.release(),pe.setCursor(J.allowSelect?"crosshair":"default")}function b(t){if(J.disabled)return!1;if(!J.allowSelect)return!1;ie=!0,T=a(N),fe.disableHandles(),pe.setCursor("crosshair");var e=s(t);return le.setPressed(e),fe.update(),pe.activateHandlers(w,v,"touch"===t.type.substring(0,5)),ge.watchKeys(),t.stopPropagation(),t.preventDefault(),!1}function w(t){le.setCurrent(t),fe.update()}function m(){var e=t("<div></div>").addClass(o("tracker"));return A&&e.css({opacity:0,backgroundColor:"white"}),e}function y(t){V.removeClass().addClass(o("holder")).addClass(t)}function x(t,e){function n(){window.setTimeout(w,l)}var i=t[0]/ee,o=t[1]/ne,r=t[2]/ee,a=t[3]/ne;if(!oe){var s=le.flipCoords(i,o,r,a),c=le.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=J.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],v=0,b=J.swingSpeed;i=d[0],o=d[1],r=d[2],a=d[3],fe.animMode(!0);var w=function(){return function(){v+=(100-v)/b,d[0]=Math.round(i+v/100*h),d[1]=Math.round(o+v/100*f),d[2]=Math.round(r+v/100*p),d[3]=Math.round(a+v/100*g),v>=99.8&&(v=100),100>v?(S(d),n()):(fe.done(),fe.animMode(!1),"function"==typeof e&&e.call(ve))}}();n()}}function C(t){S([t[0]/ee,t[1]/ne,t[2]/ee,t[3]/ne]),J.onSelect.call(ve,g(le.getFixed())),fe.enableHandles()}function S(t){le.setPressed([t[0],t[1]]),le.setCurrent([t[2],t[3]]),fe.update()}function k(){return g(le.getFixed())}function z(){return le.getFixed()}function M(t){c(t),H()}function O(){J.disabled=!0,fe.disableHandles(),fe.setCursor("default"),pe.setCursor("default")}function j(){J.disabled=!1,H()}function I(){fe.done(),pe.activateHandlers(null,null)}function F(){V.remove(),K.show(),K.css("visibility","visible"),t(e).removeData("Jcrop")}function B(t,e){fe.release(),O();var n=new Image;n.onload=function(){var i=n.width,o=n.height,r=J.boxWidth,a=J.boxHeight;N.width(i).height(o),N.attr("src",t),q.attr("src",t),p(N,r,a),Y=N.width(),Q=N.height(),q.width(Y).height(Q),se.width(Y+2*ae).height(Q+2*ae),V.width(Y).height(Q),he.resize(Y,Q),j(),"function"==typeof e&&e.call(ve)},n.src=t}function D(t,e,n){var i=e||J.bgColor;J.bgFade&&r()&&J.fadeTime&&!n?t.animate({backgroundColor:i},{queue:!1,duration:J.fadeTime}):t.css("backgroundColor",i)}function H(t){J.allowResize?t?fe.enableOnly():fe.enableHandles():fe.disableHandles(),pe.setCursor(J.allowSelect?"crosshair":"default"),fe.setCursor(J.allowMove?"move":"default"),J.hasOwnProperty("trueSize")&&(ee=J.trueSize[0]/Y,ne=J.trueSize[1]/Q),J.hasOwnProperty("setSelect")&&(C(J.setSelect),fe.done(),delete J.setSelect),he.refresh(),J.bgColor!=ce&&(D(J.shade?he.getShades():V,J.shade?J.shadeColor||J.bgColor:J.bgColor),ce=J.bgColor),ue!=J.bgOpacity&&(ue=J.bgOpacity,J.shade?he.refresh():fe.setBgOpacity(ue)),G=J.maxSize[0]||0,U=J.maxSize[1]||0,Z=J.minSize[0]||0,te=J.minSize[1]||0,J.hasOwnProperty("outerImage")&&(N.attr("src",J.outerImage),delete J.outerImage),fe.refresh()}var T,J=t.extend({},t.Jcrop.defaults),P=navigator.userAgent.toLowerCase(),A=/msie/.test(P),R=/msie [1-6]\./.test(P);"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof n&&(n={}),c(n);var W={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},K=t(e),_=!0;if("IMG"==e.tagName){if(0!=K[0].width&&0!=K[0].height)K.width(K[0].width),K.height(K[0].height);else{var E=new Image;E.src=K[0].src,K.width(E.width),K.height(E.height)}var N=K.clone().removeAttr("id").css(W).show();N.width(K.width()),N.height(K.height()),K.after(N).hide()}else N=K.css(W).show(),_=!1,null===J.shade&&(J.shade=!0);p(N,J.boxWidth,J.boxHeight);var Y=N.width(),Q=N.height(),V=t("<div />").width(Y).height(Q).addClass(o("holder")).css({position:"relative",backgroundColor:J.bgColor}).insertAfter(K).append(N);J.addClass&&V.addClass(J.addClass);var q=t("<div />"),L=t("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),X=t("<div />").width("100%").height("100%").css("zIndex",320),$=t("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var t=le.getFixed();J.onDblClick.call(ve,t)}).insertBefore(N).append(L,X);_&&(q=t("<img />").attr("src",N.attr("src")).css(W).width(Y).height(Q),L.append(q)),R&&$.css({overflowY:"hidden"});var G,U,Z,te,ee,ne,ie,oe,re,ae=J.boundary,se=m().width(Y+2*ae).height(Q+2*ae).css({position:"absolute",top:i(-ae),left:i(-ae),zIndex:290}).mousedown(b),ce=J.bgColor,ue=J.bgOpacity;T=a(N);var de=function(){function t(){var t,e={},n=["touchstart","touchmove","touchend"],i=document.createElement("div");try{for(t=0;n.length>t;t++){var o=n[t];o="on"+o;var r=o in i;r||(i.setAttribute(o,"return;"),r="function"==typeof i[o]),e[n[t]]=r}return e.touchstart&&e.touchend&&e.touchmove}catch(a){return!1}}function e(){return J.touchSupport===!0||J.touchSupport===!1?J.touchSupport:t()}return{createDragger:function(t){return function(e){return J.disabled?!1:"move"!==t||J.allowMove?(T=a(N),ie=!0,u(t,s(de.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1):!1}},newSelection:function(t){return b(de.cfilter(t))},cfilter:function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t},isSupported:t,support:e()}}(),le=function(){function t(t){t=a(t),p=h=t[0],g=f=t[1]}function e(t){t=a(t),d=t[0]-p,l=t[1]-g,p=t[0],g=t[1]}function n(){return[d,l]}function i(t){var e=t[0],n=t[1];0>h+e&&(e-=e+h),0>f+n&&(n-=n+f),g+n>Q&&(n+=Q-(g+n)),p+e>Y&&(e+=Y-(p+e)),h+=e,p+=e,f+=n,g+=n}function o(t){var e=r();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function r(){if(!J.aspectRatio)return c();var t,e,n,i,o=J.aspectRatio,r=J.minSize[0]/ee,a=J.maxSize[0]/ee,d=J.maxSize[1]/ne,l=p-h,v=g-f,b=Math.abs(l),w=Math.abs(v),m=b/w;return 0===a&&(a=10*Y),0===d&&(d=10*Q),o>m?(e=g,n=w*o,t=0>l?h-n:n+h,0>t?(t=0,i=Math.abs((t-h)/o),e=0>v?f-i:i+f):t>Y&&(t=Y,i=Math.abs((t-h)/o),e=0>v?f-i:i+f)):(t=p,i=b/o,e=0>v?f-i:f+i,0>e?(e=0,n=Math.abs((e-f)*o),t=0>l?h-n:n+h):e>Q&&(e=Q,n=Math.abs(e-f)*o,t=0>l?h-n:n+h)),t>h?(r>t-h?t=h+r:t-h>a&&(t=h+a),e=e>f?f+(t-h)/o:f-(t-h)/o):h>t&&(r>h-t?t=h-r:h-t>a&&(t=h-a),e=e>f?f+(h-t)/o:f-(h-t)/o),0>t?(h-=t,t=0):t>Y&&(h-=t-Y,t=Y),0>e?(f-=e,e=0):e>Q&&(f-=e-Q,e=Q),u(s(h,f,t,e))}function a(t){return 0>t[0]&&(t[0]=0),0>t[1]&&(t[1]=0),t[0]>Y&&(t[0]=Y),t[1]>Q&&(t[1]=Q),[Math.round(t[0]),Math.round(t[1])]}function s(t,e,n,i){var o=t,r=n,a=e,s=i;return t>n&&(o=n,r=t),e>i&&(a=i,s=e),[o,a,r,s]}function c(){var t,e=p-h,n=g-f;return G&&Math.abs(e)>G&&(p=e>0?h+G:h-G),U&&Math.abs(n)>U&&(g=n>0?f+U:f-U),te/ne&&te/ne>Math.abs(n)&&(g=n>0?f+te/ne:f-te/ne),Z/ee&&Z/ee>Math.abs(e)&&(p=e>0?h+Z/ee:h-Z/ee),0>h&&(p-=h,h-=h),0>f&&(g-=f,f-=f),0>p&&(h-=p,p-=p),0>g&&(f-=g,g-=g),p>Y&&(t=p-Y,h-=t,p-=t),g>Q&&(t=g-Q,f-=t,g-=t),h>Y&&(t=h-Q,g-=t,f-=t),f>Q&&(t=f-Q,g-=t,f-=t),u(s(h,f,p,g))}function u(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var d,l,h=0,f=0,p=0,g=0;return{flipCoords:s,setPressed:t,setCurrent:e,getOffset:n,moveOffset:i,getCorner:o,getFixed:r}}(),he=function(){function e(t,e){p.left.css({height:i(e)}),p.right.css({height:i(e)})}function n(){return o(le.getFixed())}function o(t){p.top.css({left:i(t.x),width:i(t.w),height:i(t.y)}),p.bottom.css({top:i(t.y2),left:i(t.x),width:i(t.w),height:i(Q-t.y2)}),p.right.css({left:i(t.x2),width:i(Y-t.x2)}),p.left.css({width:i(t.x)})}function r(){return t("<div />").css({position:"absolute",backgroundColor:J.shadeColor||J.bgColor}).appendTo(f)}function a(){h||(h=!0,f.insertBefore(N),n(),fe.setBgOpacity(1,0,1),q.hide(),s(J.shadeColor||J.bgColor,1),fe.isAwake()?u(J.bgOpacity,1):u(1,1))}function s(t,e){D(l(),t,e)}function c(){h&&(f.remove(),q.show(),h=!1,fe.isAwake()?fe.setBgOpacity(J.bgOpacity,1,1):(fe.setBgOpacity(1,1,1),fe.disableHandles()),D(V,0,1))}function u(t,e){h&&(J.bgFade&&!e?f.animate({opacity:1-t},{queue:!1,duration:J.fadeTime}):f.css({opacity:1-t}))}function d(){J.shade?a():c(),fe.isAwake()&&u(J.bgOpacity)}function l(){return f.children()}var h=!1,f=t("<div />").css({position:"absolute",zIndex:240,opacity:0}),p={top:r(),left:r().height(Q),right:r().height(Q),bottom:r()};return{update:n,updateRaw:o,getShades:l,setBgColor:s,enable:a,disable:c,resize:e,refresh:d,opacity:u}}(),fe=function(){function e(e){var n=t("<div />").css({position:"absolute",opacity:J.borderOpacity}).addClass(o(e));return L.append(n),n}function n(e,n){var i=t("<div />").mousedown(f(e)).css({cursor:e+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+e);return de.support&&i.bind("touchstart.jcrop",de.createDragger(e)),X.append(i),i}function r(t){var e=J.handleSize,i=n(t,O++).css({opacity:J.handleOpacity}).addClass(o("handle"));return e&&i.width(e).height(e),i}function a(t){return n(t,O++).addClass("jcrop-dragbar")}function s(t){var e;for(e=0;t.length>e;e++)F[t[e]]=a(t[e])}function c(t){var n,i;for(i=0;t.length>i;i++){switch(t[i]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}j[t[i]]=e(n)}}function u(t){var e;for(e=0;t.length>e;e++)I[t[e]]=r(t[e])}function d(t,e){J.shade||q.css({top:i(-e),left:i(-t)}),$.css({top:i(e),left:i(t)})}function l(t,e){$.width(Math.round(t)).height(Math.round(e))}function h(){var t=le.getFixed();le.setPressed([t.x,t.y]),le.setCurrent([t.x2,t.y2]),p()}function p(t){return M?v(t):void 0}function v(t){var e=le.getFixed();l(e.w,e.h),d(e.x,e.y),J.shade&&he.updateRaw(e),M||w(),t?J.onSelect.call(ve,g(e)):J.onChange.call(ve,g(e))}function b(t,e,n){(M||e)&&(J.bgFade&&!n?N.animate({opacity:t},{queue:!1,duration:J.fadeTime}):N.css("opacity",t))}function w(){$.show(),J.shade?he.opacity(ue):b(ue,!0),M=!0}function y(){S(),$.hide(),J.shade?he.opacity(1):b(1),M=!1,J.onRelease.call(ve)}function x(){B&&X.show()}function C(){return B=!0,J.allowResize?(X.show(),!0):void 0}function S(){B=!1,X.hide()}function k(t){t?(oe=!0,S()):(oe=!1,C())}function z(){k(!1),h()}var M,O=370,j={},I={},F={},B=!1;J.dragEdges&&t.isArray(J.createDragbars)&&s(J.createDragbars),t.isArray(J.createHandles)&&u(J.createHandles),J.drawBorders&&t.isArray(J.createBorders)&&c(J.createBorders),t(document).bind("touchstart.jcrop-ios",function(e){t(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var D=m().mousedown(f("move")).css({cursor:"move",position:"absolute",zIndex:360});return de.support&&D.bind("touchstart.jcrop",de.createDragger("move")),L.append(D),S(),{updateVisible:p,update:v,release:y,refresh:h,isAwake:function(){return M},setCursor:function(t){D.css("cursor",t)},enableHandles:C,enableOnly:function(){B=!0},showHandles:x,disableHandles:S,animMode:k,setBgOpacity:b,done:z}}(),pe=function(){function e(e){se.css({zIndex:450}),e?t(document).bind("touchmove.jcrop",a).bind("touchend.jcrop",c):h&&t(document).bind("mousemove.jcrop",i).bind("mouseup.jcrop",o)}function n(){se.css({zIndex:290}),t(document).unbind(".jcrop")}function i(t){return d(s(t)),!1}function o(t){return t.preventDefault(),t.stopPropagation(),ie&&(ie=!1,l(s(t)),fe.isAwake()&&J.onSelect.call(ve,g(le.getFixed())),n(),d=function(){},l=function(){}),!1}function r(t,n,i){return ie=!0,d=t,l=n,e(i),!1}function a(t){return d(s(de.cfilter(t))),!1}function c(t){return o(de.cfilter(t))}function u(t){se.css("cursor",t)}var d=function(){},l=function(){},h=J.trackDocument;return h||se.mousemove(i).mouseup(o).mouseout(o),N.before(se),{activateHandlers:r,setCursor:u}}(),ge=function(){function e(){J.keySupport&&(r.show(),r.focus())}function n(){r.hide()}function i(t,e,n){J.allowMove&&(le.moveOffset([e,n]),fe.updateVisible(!0)),t.preventDefault(),t.stopPropagation()}function o(t){if(t.ctrlKey||t.metaKey)return!0;re=t.shiftKey?!0:!1;var e=re?10:1;switch(t.keyCode){case 37:i(t,-e,0);break;case 39:i(t,e,0);break;case 38:i(t,0,-e);break;case 40:i(t,0,e);break;case 27:J.allowSelect&&fe.release();break;case 9:return!0}return!1}var r=t('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),a=t("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return J.keySupport&&(r.keydown(o).blur(n),R||!J.fixedSupport?(r.css({position:"absolute",left:"-20px"}),a.append(r).insertBefore(N)):r.insertBefore(N)),{watchKeys:e}}();de.support&&se.bind("touchstart.jcrop",de.newSelection),X.hide(),H(!0);var ve={setImage:B,animateTo:x,setSelect:C,setOptions:M,tellSelect:k,tellScaled:z,setClass:y,disable:O,enable:j,cancel:I,release:fe.release,destroy:F,focus:ge.watchKeys,getBounds:function(){return[Y*ee,Q*ne]},getWidgetSize:function(){return[Y,Q]},getScaleFactor:function(){return[ee,ne]},getOptions:function(){return J},ui:{holder:V,selection:$}};return A&&V.bind("selectstart",function(){return!1}),K.data("Jcrop",ve),ve},t.fn.Jcrop=function(e,n){var i;return this.each(function(){if(t(this).data("Jcrop")){if("api"===e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?t.Jcrop.Loader(this,function(){t(this).css({display:"block",visibility:"hidden"}),i=t.Jcrop(this,e),t.isFunction(n)&&n.call(i)}):(t(this).css({display:"block",visibility:"hidden"}),i=t.Jcrop(this,e),t.isFunction(n)&&n.call(i))}),this},t.Jcrop.Loader=function(e,n,i){function o(){a.complete?(r.unbind(".jcloader"),t.isFunction(n)&&n.call(a)):window.setTimeout(o,50)}var r=t(e),a=r[0];r.bind("load.jcloader",o).bind("error.jcloader",function(){r.unbind(".jcloader"),t.isFunction(i)&&i.call(a)}),a.complete&&t.isFunction(n)&&(r.unbind(".jcloader"),n.call(a))},t.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery),function(){jQuery(function(t){var e,n,i,o,r,a,s,c,u,d,l,h,f,p,g,v,b,w;return r=function(){return t("#positioning, #visualization .visualization").hide()},r(),e="click",n="<div/>",u=null,d=null,s=null,c=null,o=function(t,e,n){return t.fadeOut(function(){return t.add(e).remove(),"function"==typeof n?n():void 0})},i=function(){return window.confirm("Confirm mapping position?")},l=function(e){var n;return n=t("#positioning"),n.find(".positioning-coordinate-x1").val(Math.round(e.x)),n.find(".positioning-coordinate-y1").val(Math.round(e.y)),n.find(".positioning-coordinate-x2").val(Math.round(e.x2)),n.find(".positioning-coordinate-y2").val(Math.round(e.y2))},f=function(e){return t("#visualization-id").val(e)},h=function(e){var n,r;return n=e.find("img"),r=n.data(),n.Jcrop({boxWidth:e.width(),trueSize:[r.width,r.height],onSelect:function(r){return i()?(l(r),f(t(n).data("id")),o(e,c)):void 0}})},g=function(i){var r,a;if(i)return s||(s=t(n,{id:"tv-mapper"}).hide(),c=t(n,{id:"tv-modal-bg"}).on(e,function(){return o(s,c)}),t("body").append(s).append(c)),r=t("<img/>",{src:i.src,data:{id:i.id,width:i.width,height:i.height}}),a=t(n,{"class":"mapper-wrapper"}).append(r),s.append(a),h(s),s.fadeIn()},w=function(t){return o(u,d,function(){var e;return e=JSON.parse(t),g(e)})},a=function(e){var n;return n={action:"get_visualization_mapper",visualizationId:e},t.post(ajaxurl,n,w)},p=function(n){return n.on(e,".image",function(){var e;return e=t(this).parents("tr").data("visualizationId"),a(e)})},v=function(i){return i?(u||(u=t(n,{id:"tv-modal"}).hide(),d=t(n,{id:"tv-modal-bg"}).on(e,function(){return o(u,d)}),t("body").append(u).append(d)),u.html(i),p(u),u.fadeIn()):void 0},b=function(e){return e.preventDefault(),t.post(ajaxurl,{action:"get_visualizations_list"},v)},t("#visualization").on(e,".js-visualization-trigger",b)})}.call(this);